!function(a,c){"function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(exports){return c(a,exports)}):a.Mobilebone=c(a,{})}(this,function(a,c){var y={},g=[],h=g.slice,v="pushState"in history&&"replaceState"in history&&!(window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window)&&-1===window.navigator.userAgent.search(/CriOS/);if(c.support=v,0==v)return c;c.VERSION="1.1.4",c.autoInit=!0,c.captureLink=!0,c.rootTransition=a,c.mergeCallback=!0,c.classPage="page",c.classMask="mask",c.pushStateEnabled=!0,c.transition=function(a,g,h,k){if(0!=arguments.length&&a!=g){3==arguments.length&&1==isNaN(1*h)&&(k=h,h=!1),g=g||null,h=h||!1,k=k||{};var E={root:this.rootTransition,form:"slide",onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,fallback:this.fallback,callback:this.callback},L=function(a){if(!a||!a.getAttribute)return{};var y={},g=b(a.getAttribute("data-params")||"");return["title","root","form"].forEach(function(c){y[c]=a.getAttribute("data-"+c)||g[c]||k[c]||E[c]}),"string"==typeof y.root&&(y.root=c.getFunction(y.root)),["onpagefirstinto","callback","fallback","animationstart","animationend"].forEach(function(h){if(1==c.mergeCallback&&"function"==typeof E[h]){var v=a.getAttribute("data-"+h)||g[h];y[h]="function"==typeof y.root[v]?function(){E[h].apply(null,arguments),y.root[v].apply(null,arguments)}:"function"==typeof k[h]?function(){E[h].apply(null,arguments),k[h].apply(null,arguments)}:E[h]}else y[h]=a.getAttribute("data-"+h)||g[h]||k[h]||E[h]}),y},S=L(g),A=L(a);if(null!=g&&g.classList){g.classList.add("out"),g.classList.add(S.form),g.classList.remove("in"),g.classList[h?"add":"remove"]("reverse");var w=S.fallback;"string"==typeof w&&(w=S.root[w]),"function"==typeof w&&w(a,g,k.response)}if(null!=a&&a.classList){var P=A.title,T=document.querySelector("h1"),C=document.querySelector("."+this.classPage);P?(document.title=P,T&&(T.innerHTML=P,T.title=P)):C==a&&!g&&document.title&&a.setAttribute("data-title",document.title);var j=k.id||a.id;y[j]&&y[j]!=a&&(y[j].parentElement.removeChild(y[j]),delete y[j]),a.style.display="block",a.clientWidth,a.classList.remove("out"),a.classList.add("in"),g&&a.classList.add(A.form),a.classList[h?"add":"remove"]("reverse");var N=A.onpagefirstinto;y[j]||("string"==typeof N&&A.root[N]?A.root[N](a,g,k.response):"function"==typeof N&&N(a,g,k.response));var B="WebkitAppearance"in document.documentElement.style||"undefined"!=typeof document.webkitHidden;["animationstart","animationend"].forEach(function(c,g){var h=A[c],v="webkit"+c.replace(/^a|s|e/g,function(a){return a.toUpperCase()});if(!y[j]){var b=B?v:c;g&&a.addEventListener(b,function(){0==this.classList.contains("in")&&(this.style.display="none")}),"string"==typeof h&&A.root[h]?a.addEventListener(b,function(){A.root[h](this,this.classList.contains("in")?"into":"out")}):"function"==typeof h&&a.addEventListener(b,function(){h(this,this.classList.contains("in")?"into":"out")})}});var M=j;M&&0==/^#/.test(M)&&(M="#"+M),v&&this.pushStateEnabled&&k.history!==!1&&M&&history[g?"pushState":"replaceState"](null,document.title,M.replace(/^#/,"#&")),y[j]||(y[j]=a);var O=A.callback;"string"==typeof O&&(O=A.root[O]),"function"==typeof O&&O(a,g,k.response)}}},c.getCleanUrl=function(a,c,y){var g="",h="",v="";if(a&&(1==a.nodeType?(g=a.getAttribute("href"),h=a.getAttribute("data-formdata")||a.getAttribute("data-data")):a.url&&(g=a.url,h=a.data)),!(g=g||c))return"";if(h=h||y||"","object"==typeof h){var b=[];for(key in y)b.push(key+"="+encodeURIComponent(y[key]));h=b.length>0?b.join("&"):""}return v=g.split("#")[0].replace(/&+$/,""),"?"==v.slice(-1)&&(v=v.split("?")[0]),""!=h&&(/\?/.test(v)?(h=h.replace(/^&|\?/,""),v=v+"&"+h):""!=h&&(h=h.replace("?",""),v=v+"?"+h)),v},c.getPage=function(a){var c=null;return h.call(document.querySelectorAll("."+this.classPage)).forEach(function(y){null==c&&y.contains(a)&&(c=y)}),c},c.createPage=function(a,c,y){var g=null;if(a){y=y||{};var h,v=document.querySelector(".in."+this.classPage);c&&(1==c.nodeType?(c.classList.contains(this.classPage)?v=c:c.href&&(v=this.getPage(c),h=c.getAttribute("data-title")||y.title),g=y.response):(g=c.response||y.response,h=c.title||y.title));var b=null,k=document.createElement("div");"string"==typeof a?k.innerHTML=a:k.appendChild(a);var E=k.getElementsByTagName("title")[0];(b=k.querySelector("."+this.classPage))?E?b.setAttribute("data-title",E.innerText):"string"==typeof h&&b.setAttribute("data-title",h):(k.className="page out","string"==typeof h&&k.setAttribute("data-title",h),b=k),document.body.appendChild(b),k=null,this.transition(b,v,{response:g||a,id:this.getCleanUrl(c)||b.id||"unique"+Date.now()})}},c.getFunction=function(c){if("string"==typeof c){for(var y=a,g=c.split("."),h=0;h<g.length&&(y=y[g[h]]);h+=1);return y}},c.ajax=function(a){if(a){var y,g={url:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},h={},v=null,k={};if(1==a.nodeType){k=b(a.getAttribute("data-params")||"");for(key in g)h[key]=a.getAttribute("data-"+key)||k[key]||g[key],"function"==typeof g[key]&&"string"==typeof h[key]&&(h[key]=this.getFunction(h[key]),"function"!=typeof h[key]&&(h[key]=g[key]));h.url=this.getCleanUrl(a,h.url),y=a.getAttribute("data-mask"),("true"==y||""==y)&&(v=a.querySelector("."+this.classMask))}else{if(!a.url)return;for(key2 in g)h[key2]=a[key2]||g[key2];h.url=this.getCleanUrl(null,h.url,h.data),h.title=a.title}"string"!=typeof y&&(v=document.querySelector("body > ."+this.classMask)),null==v&&(v=document.createElement("div"),v.className=this.classMask,v.innerHTML='<i class="loading"></i>',"string"==typeof y?a.appendChild(v):document.body.appendChild(v)),v.style.visibility="visible";var E=new XMLHttpRequest;E.open("GET",h.url+(/\?/.test(h.url)?"&":"?")+"r="+Date.now(),h.async,h.username,h.password),E.timeout=h.timeout,E.onload=function(){var y=null;if(200==E.status){if("json"==h.dataType||"JSON"==h.dataType)try{y=JSON.parse(E.response),h.response=y,c.createPage(c.jsonHandle(y),a,h)}catch(e){h.message="JSON parse errorï¼š"+e.message,h.error.call(h,E,E.status)}else if("unknown"==h.dataType)try{y=JSON.parse(E.response),h.response=y,c.createPage(c.jsonHandle(y),a,h)}catch(e){y=E.response,c.createPage(y,a,h)}else y=E.response,c.createPage(y,a,h);h.success.call(h,y,E.status)}else h.message="The status code exception!",h.error.call(h,E,E.status);h.complete.call(h,E,E.status),v.style.visibility="hidden"},E.onerror=function(){h.message="Illegal request address or an unexpected network error!",h.error.call(h,E,E.status),v.style.visibility="hidden"},E.ontimeout=function(){h.message="The request timeout!",h.error.call(h,E,E.status),v.style.visibility="hidden"},E.send(null)}},c.isBack=function(a,y){var g=-1,v=-1;return 1==history.tempBack?v=0:h.call(document.querySelectorAll("."+c.classPage)).forEach(function(c,h){c==a?g=h:c==y&&(v=h)}),history.tempBack=null,v>g},c.jsonHandle=function(){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},c.init=function(){var y=location.hash.replace("#&","#"),g=null;""==y||"#"==y?this.transition(document.querySelector("."+this.classPage)):0==/&/.test(y)&&(g=document.querySelector(y))&&g.classList.contains(this.classPage)?this.transition(g):this.ajax({url:y.replace("#",""),dataType:"unknown",error:function(){g=document.querySelector("."+c.classPage),c.transition(g)}});var h="click",v=a.$||a.jQuery||a.Zepto;v&&v.fn&&v.fn.tap&&(h="tap"),1==this.captureLink&&document.addEventListener(h,this.handleTapEvent)},c.handleTapEvent=function(a){var g=a.target||a.touches[0],h=g.href;!h&&(g=g.getParentElementByTag("a"))&&(h=g.href);var v=document.querySelector(".in."+c.classPage);if(null!=v&&g){var b=g.getElementsByClassName(c.classMask)[0];if(b&&"hidden"!=b.style.visibility)return a.preventDefault(),!1;var k=1==c.captureLink,E=g.getAttribute("data-rel"),L=!1;"back"==E&&(L=!0);var S="external"==E;if(h){if(/^javascript/.test(h)){if(0==L)return}else if(S=S||h.split("/")[0]!==location.href.split("/")[0],(1==S||0==k)&&"true"!=g.getAttribute("data-ajax"))return;if(1==/^#/.test(g.getAttribute("href"))){var A=h.split("#")[1],w=A&&document.getElementById(A);0==L&&"auto"==E&&(L=c.isBack(w,v)),w&&c.transition(w,v,L),a.preventDefault()}else if(/^javascript/.test(h))history.tempBack=!0,history.back();else if("false"!=g.getAttribute("data-ajax")){var P=c.getCleanUrl(g),T=g.getAttribute("data-reload"),C=g.getAttribute("href");null!=T&&"false"!=T||!y[P]?c.ajax(g):(0==L&&"auto"==E&&(L=c.isBack(y[C],v)),c.transition(y[C],v,L,{id:C})),a.preventDefault()}}}},Element.prototype.getParentElementByTag=function(a){if(!a)return null;var c=null,y=this,g=function(){y=y.parentElement;var h=y.tagName.toLowerCase();h===a?c=y:"body"==h?c=null:g()};return g(),c};var b=function(a){var c={};return"string"==typeof a&&a.split("&").forEach(function(a){var y=a.split("=");y.length>1&&(c[y[0]]=a.replace(y[0]+"=",""))}),c};return window.addEventListener("DOMContentLoaded",function(){1==c.autoInit&&c.init()}),v&&window.addEventListener("popstate",function(){var a=location.hash.replace("#&","").replace("#","");if(""!=a){var g=y[a]||document.querySelector(location.hash),h=document.querySelector(".in."+c.classPage);g&&g==h||y[a]&&c.pushStateEnabled&&c.transition(y[a],document.querySelector(".in."+c.classPage),c.isBack(g,h),{history:!1})}}),c});